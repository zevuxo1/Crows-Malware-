FARPROC GetInfoAddress(IN HMODULE hNTDLL, IN LPCSTR ProcName) {
	PBYTE pBase = (PBYTE)hNTDLL;

	PIMAGE_DOS_HEADER pImgDos = (PIMAGE_DOS_HEADER)pBase;
	if (pImgDos->e_magic != IMAGE_DOS_SIGNATURE) {
		printf("Not a Valid Dos header");
		return NULL;
	}

	PIMAGE_NT_HEADERS pImgNT = (PIMAGE_NT_HEADERS)(pBase + pImgDos->e_lfanew);
	if (pImgNT->Signature != IMAGE_NT_SIGNATURE) {
		printf("Not a Valid NT Header");
		return NULL;
	}

	IMAGE_OPTIONAL_HEADER pImgOpt = pImgNT->OptionalHeader;

	PIMAGE_EXPORT_DIRECTORY pImgExportDir = (PIMAGE_EXPORT_DIRECTORY)(pBase + pImgOpt.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].VirtualAddress);

	PDWORD FuncNameArray = (PDWORD)(pBase + pImgExportDir->AddressOfNames);
	PDWORD FuncAddrArray = (PDWORD)(pBase + pImgExportDir->AddressOfFunctions);
	PWORD FuncOrdinalArray = (PWORD)(pBase + pImgExportDir->AddressOfNameOrdinals);
	
	for (DWORD i = 0; i < pImgExportDir->NumberOfFunctions; i++) {
		CHAR* pFuncName = (CHAR*)(pBase + FuncNameArray[i]);

		PVOID pFuncAddr = (PVOID)(pBase + FuncAddrArray[FuncOrdinalArray[i]]);

		if (strcmp(ProcName, pFuncName) == 0) {
			return pFuncAddr;
		}
	}
	return NULL;
}
